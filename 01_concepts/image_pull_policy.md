# 이미지 풀 정책 (Image Pull Policy)

쿠버네티스에서 파드를 실행할 때, 컨테이너 이미지를 어떻게 가져올지 결정하는 설정인 **Image Pull Policy**에 대해 상세히 알아봅니다.

## 1. 개요

쿠버네티스 클러스터의 각 노드(Node)는 컨테이너를 실행하기 위해 이미지를 필요로 합니다. `imagePullPolicy` 설정은 이미 노드에 이미지가 있을 때 새로 받을지, 아니면 기존 것을 쓸지 등을 결정합니다.

## 2. 정책 종류

| 옵션 | 설명 | 비유 |
| :--- | :--- | :--- |
| **`Always`** | 로컬에 이미지가 있더라도 **항상 원격 레지스트리**에서 이미지를 새로 다운로드합니다. | 매번 새로 배달시켜 먹기 |
| **`IfNotPresent`** | 로컬에 이미지가 있으면 그것을 사용하고, **없을 때만** 다운로드합니다. (기본 권장) | 냉장고에 있으면 먹고, 없으면 배달하기 |
| **`Never`** | **무조건 로컬**에 있는 이미지만 사용합니다. 원격에서 가져오지 않습니다. | 무조건 집밥만 먹기 (없으면 굶기) |

---

## 3. 기본값(Default) 설정 규칙

`imagePullPolicy`를 명시적으로 적지 않았을 때, 쿠버네티스는 이미지의 **태그(Tag)**를 보고 자동으로 결정합니다.

1.  **태그가 `:latest`인 경우**: 기본값은 **`Always`**입니다.
2.  **태그가 없는 경우**: 이미지 이름 뒤에 태그가 없으면 `:latest`로 간주되므로, 기본값은 **`Always`**입니다.
3.  **태그가 특정 버전(예: `:v1.0`)인 경우**: 기본값은 **`IfNotPresent`**입니다.

### ⚠️ 주의사항
실습 환경(Docker Desktop, Minikube 등)에서 로컬 빌드 이미지를 사용할 때 태그를 붙이지 않으면, 쿠버네티스는 원격 저장소(Docker Hub)에서 `:latest`를 찾으려고 시도하다가 실패(`ImagePullBackOff`)할 수 있습니다.

---

## 4. 상황별 권장 설정

### ① 개발 및 로컬 실습 환경
- **로컬 빌드 이미지 사용 시**: `IfNotPresent` 또는 `Never`를 사용해야 로컬 이미지를 인식합니다.
- **이미지가 자주 바뀌는 경우**: `:latest` 태그와 함께 `Always`를 사용하여 항상 최신 코드를 반영합니다.

### ② 운영(Production) 환경
- **버전 관리**: 항상 특정 버전 태그(예: `myapp:v1.2.3`)를 사용하는 것이 안전합니다. 
- **속도와 안정성**: `IfNotPresent`를 사용하여 불필요한 네트워크 트래픽을 줄이고 빠른 기동을 유도합니다.

---

## 5. 매니페스트 적용 예시

```yaml
spec:
  containers:
    - name: my-app
      image: my-image:v1
      imagePullPolicy: IfNotPresent # 명시적으로 설정
```

## 6. 요약

- **항상 새것**: `Always`
- **없을 때만**: `IfNotPresent`
- **절대 안 받음**: `Never`

태그가 없거나 `:latest`면 **무조건 원격에서 받으려 한다**는 점을 꼭 기억하세요!
