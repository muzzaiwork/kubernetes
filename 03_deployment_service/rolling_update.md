# μƒλ΅μ΄ λ²„μ „μ μ„λ²„λ΅ μ—…λ°μ΄νΈν•κΈ° (Rolling Update)

μ‹¤μ  μ„λΉ„μ¤λ¥Ό μ΄μν•λ‹¤ λ³΄λ©΄ μƒλ΅μ΄ κΈ°λ¥μ„ μ¶”κ°€ν•κ±°λ‚ λ²„κ·Έλ¥Ό μμ •ν•μ—¬ μ„λ²„ λ²„μ „μ„ μ—…λ°μ΄νΈν•΄μ•Ό ν•  μΌμ΄ μμ£Ό λ°μƒν•λ‹¤. μΏ λ²„λ„¤ν‹°μ¤μ—μ„λ” μ„λΉ„μ¤ μ¤‘λ‹¨ μ—†μ΄ μƒλ΅μ΄ λ²„μ „μΌλ΅ κµμ²΄ν•λ” **λ΅¤λ§ μ—…λ°μ΄νΈ(Rolling Update)** λ°©μ‹μ„ μ§€μ›ν•λ‹¤.

---

### β… μƒλ΅μ΄ λ²„μ „μ μ„λ²„λ΅ μ—…λ°μ΄νΈ κ³Όμ •

#### 1. μ½”λ“ μμ • λ° λΉλ“

λ¨Όμ € μ• ν”λ¦¬μΌ€μ΄μ…μ μ½”λ“λ¥Ό μμ •ν•κ³  μƒλ΅μ΄ μ΄λ―Έμ§€λ¥Ό μƒμ„±ν•λ‹¤.

**β‘  μ†μ¤ μ½”λ“ μμ •** (μ: μ‘λ‹µ λ©”μ‹μ§€λ¥Ό "Version 1.0"μΌλ΅ λ³€κ²½)
**β‘΅ Spring Boot λΉλ“**
```bash
$ ./gradlew clean build
```
**β‘Ά μƒλ΅μ΄ λ²„μ „μ μ΄λ―Έμ§€ λΉλ“**
νƒκ·Έλ¥Ό `:1.0`μΌλ΅ μ§€μ •ν•μ—¬ μƒλ΅μ΄ μ΄λ―Έμ§€λ¥Ό μƒμ„±ν•λ‹¤.
```bash
$ docker build -t spring-server:1.0 .
```

#### 2. λ§¤λ‹νμ¤νΈ νμΌ μμ •

λ””ν”λ΅μ΄λ¨ΌνΈ μ„¤μ • νμΌμ—μ„ μ‚¬μ©ν•  μ΄λ―Έμ§€ λ²„μ „μ„ μ—…λ°μ΄νΈν•λ‹¤.

**spring-deployment.yaml**
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: spring-deployment
spec:
  replicas: 5
  template:
    spec:
      containers:
        - name: spring-container
          image: spring-server:1.0 # μ΄λ―Έμ§€ λ²„μ „μ„ 1.0μΌλ΅ μμ •
          imagePullPolicy: IfNotPresent
```

#### 3. μ—…λ°μ΄νΈ μ μ© λ° ν™•μΈ

μμ •λ νμΌμ„ μ μ©ν•λ©΄ μΏ λ²„λ„¤ν‹°μ¤κ°€ μλ™μΌλ΅ μ—…λ°μ΄νΈλ¥Ό μ‹μ‘ν•λ‹¤.

**β‘  λ³€κ²½ μ‚¬ν•­ μ μ©**
```bash
$ kubectl apply -f 03_deployment_service/spring-deployment.yaml
```

**β‘΅ μ—…λ°μ΄νΈ μƒνƒ ν™•μΈ**
μƒλ΅μ΄ νλ“κ°€ μƒμ„±λκ³  κΈ°μ΅΄ νλ“κ°€ μ‚­μ λλ” κ³Όμ •μ„ μ‹¤μ‹κ°„μΌλ΅ ν™•μΈν•  μ μλ‹¤.
```bash
$ kubectl rollout status deployment/spring-deployment
```

**β‘Ά μµμΆ… κ²°κ³Ό ν™•μΈ**
μ„λΉ„μ¤ μ£Όμ†λ΅ μ ‘μ†ν•μ—¬ λ²„μ „μ΄ μ •μƒμ μΌλ΅ μ—…λ°μ΄νΈλμ—λ”μ§€ ν™•μΈν•λ‹¤.
```bash
$ curl localhost:30000
# μ¶λ ¥: Version 1.0
```

---

### π’΅ λ³΄κ°•: λ΅¤λ§ μ—…λ°μ΄νΈ(Rolling Update)λ€?

μΏ λ²„λ„¤ν‹°μ¤ λ””ν”λ΅μ΄λ¨ΌνΈμ κΈ°λ³Έ μ—…λ°μ΄νΈ λ°©μ‹μ΄λ‹¤.

1.  **λ¬΄μ¤‘λ‹¨ λ°°ν¬**: ν•κΊΌλ²μ— λ¨λ“  νλ“λ¥Ό μ£½μ΄κ³  μƒλ΅ λ„μ°λ” κ²ƒμ΄ μ•„λ‹λΌ, **νλ“λ¥Ό ν•λ‚μ”©(λλ” μ„¤μ •λ λΉ„μ¨λ§νΌ) μμ°¨μ μΌλ΅ κµμ²΄**ν•λ‹¤.
2.  **μ•μ •μ„±**: μƒλ΅μ΄ λ²„μ „μ νλ“κ°€ μ •μƒμ μΌλ΅ `Running` μƒνƒκ°€ λ κ²ƒμ„ ν™•μΈν• ν›„μ— λ‹¤μ νλ“λ¥Ό κµμ²΄ν•λ―€λ΅, μ—…λ°μ΄νΈ λ„μ¤‘μ—λ„ μ„λΉ„μ¤κ°€ μ¤‘λ‹¨λμ§€ μ•λ”λ‹¤.
3.  **λ΅¤λ°± μ©μ΄**: λ§μ•½ μƒλ΅μ΄ λ²„μ „μ— λ¬Έμ κ°€ μλ‹¤λ©΄ `kubectl rollout undo` λ…λ Ήμ–΄λ¥Ό ν†µν•΄ μ¦‰μ‹ μ΄μ „ λ²„μ „μΌλ΅ λλλ¦΄ μ μλ‹¤.

> **ν™•μΈ ν¬μΈνΈ**: `kubectl get pods`λ¥Ό μ…λ ¥ν–μ„ λ• κΈ°μ΅΄ νλ“λ” `Terminating` λκ³  μƒλ΅μ΄ νλ“κ°€ `Running` λλ” κ³Όμ •μ„ μ§μ ‘ λμΌλ΅ ν™•μΈν•΄ λ³΄λ” κ²ƒμ΄ μΆ‹λ‹¤.
