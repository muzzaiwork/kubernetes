# [μμ ] μ„λΉ„μ¤(Service)λ¥Ό ν™μ©ν•΄ λ°±μ—”λ“(Spring Boot) μ„λ²„μ™€ ν†µμ‹ ν•΄λ³΄κΈ°

### β… μ„λΉ„μ¤(Service)λ¥Ό ν™μ©ν•΄ λ°±μ—”λ“(Spring Boot)μ™€ ν†µμ‹ ν•΄λ³΄κΈ°

<aside>
π§‘π»β€π« **κµμ•**  
μ΄μ „ μ‹¤μµμ—μ„ λ””ν”λ΅μ΄λ¨ΌνΈλ¥Ό ν™μ©ν•΄ λ°±μ—”λ“ μ„λ²„(Spring Boot) 3κ°λ¥Ό λ„μ› λ‹¤. ν•μ§€λ§ λ””ν”λ΅μ΄λ¨ΌνΈμ— ν¬ν•¨λμ–΄ μλ” λ¨λ“  νλ“μ— κ³¨κ³ λ£¨ μ”μ²­μ„ λ¶„λ°°ν•κΈ° μ„ν•΄ μ„λΉ„μ¤(Service)λ¥Ό μƒμ„±ν•΄μ•Ό ν•λ‹¤.
</aside>

---

### 1. λ§¤λ‹νμ¤νΈ νμΌ μ‘μ„±ν•κΈ° (`spring-service.yaml`)

μ™Έλ¶€μ—μ„ μ ‘μ† κ°€λ¥ν•λ„λ΅ `NodePort` νƒ€μ…μ μ„λΉ„μ¤λ¥Ό μ •μν•λ‹¤.

> **π’΅ μμ„κ°€ μ¤‘μ”ν• κΉ?**
> μΏ λ²„λ„¤ν‹°μ¤μ—μ„λ” μ„λΉ„μ¤μ™€ λ””ν”λ΅μ΄λ¨ΌνΈ μ¤‘ λ¬΄μ—‡μ„ λ¨Όμ € μƒμ„±ν•΄λ„ μƒκ΄€μ—†λ‹¤. μ„λΉ„μ¤λ” `selector`λ¥Ό ν†µν•΄ νλ“λ¥Ό μ°Ύλ”λ°, νλ“κ°€ λ‚μ¤‘μ— μƒμ„±λλ”λΌλ„ λΌλ²¨λ§ μΌμΉν•λ©΄ μ„λΉ„μ¤κ°€ μλ™μΌλ΅ κ°μ§€ν•μ—¬ μ—°κ²°ν•κΈ° λ•λ¬Έμ΄λ‹¤. ν•μ§€λ§ μΌλ°μ μΌλ΅λ” λ€μƒμ΄ λλ” νλ“(λ””ν”λ΅μ΄λ¨ΌνΈ)λ¥Ό λ¨Όμ € λ„μ›λ†“κ³  μ„λΉ„μ¤λ¥Ό μ—°κ²°ν•λ” κ²ƒμ΄ νλ¦„μƒ μμ—°μ¤λ½λ‹¤.

```yaml
apiVersion: v1
kind: Service
metadata:
  name: spring-service
spec:
  type: NodePort # μ™Έλ¶€ μ ‘μ†μ„ ν—μ©ν•λ” μ„λΉ„μ¤ νƒ€μ…
  selector:
    app: backend-app # 'app: backend-app' λΌλ²¨μ„ κ°€μ§„ νλ“λ“¤μ„ νƒ€κ²μΌλ΅ μ§€μ •
  ports:
    - protocol: TCP
      port: 8080       # μ„λΉ„μ¤ λ‚΄λ¶€ ν¬νΈ
      targetPort: 8080 # νλ“(μ»¨ν…μ΄λ„) λ‚΄λ¶€ ν¬νΈ
      nodePort: 30000  # μ™Έλ¶€μ—μ„ μ ‘μ†ν•  ν¬νΈ (30000-32767 μ‚¬μ΄)
```

#### π’΅ μ„λΉ„μ¤ νƒ€μ… μ΄ν•΄ν•κΈ°

1.  **NodePort**: λ¨λ“  λ…Έλ“μ νΉμ • ν¬νΈ(μ—¬κΈ°μ„λ” 30000λ²)λ¥Ό μ—΄μ–΄ μ™Έλ¶€ μ ‘μ†μ„ ν—μ©ν•λ‹¤.
2.  **ClusterIP**: ν΄λ¬μ¤ν„° λ‚΄λ¶€μ—μ„λ§ ν†µμ‹  κ°€λ¥ν• κ³ μ • IPλ¥Ό λ¶€μ—¬ν•λ‹¤. (κΈ°λ³Έκ°’)
3.  **LoadBalancer**: ν΄λΌμ°λ“ ν™κ²½(AWS λ“±)μ—μ„ μ™Έλ¶€ λ΅λ“λ°Έλ°μ„λ¥Ό μλ™μΌλ΅ μƒμ„±ν•μ—¬ μ—°κ²°ν•λ‹¤.

---

### 2. μ„λΉ„μ¤ μƒμ„±ν•κΈ°

μ‘μ„±ν• λ§¤λ‹νμ¤νΈ νμΌμ„ ν΄λ¬μ¤ν„°μ— μ μ©ν•λ‹¤.

```bash
$ kubectl apply -f 03_deployment_service/spring-service.yaml
```

**μ‹¤ν–‰ κ²°κ³Ό:**
```text
service/spring-service created
```

---

### 3. μƒμ„± κ²°κ³Ό ν™•μΈν•κΈ°

μ„λΉ„μ¤κ°€ μ •μƒμ μΌλ΅ μƒμ„±λμ—λ”μ§€ ν™•μΈν•λ‹¤.

```bash
$ kubectl get service
```

**μ‹¤ν–‰ κ²°κ³Ό:**
```text
NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
kubernetes       ClusterIP   10.96.0.1       <none>        443/TCP          24h
spring-service   NodePort    10.104.22.184   <none>        8080:30000/TCP   10s
```

- `PORT(S)` ν•­λ©μ„ λ³΄λ©΄ λ‚΄λ¶€ `8080` ν¬νΈκ°€ μ™Έλ¶€ `30000` ν¬νΈλ΅ λ§¤ν•‘λ κ²ƒμ„ λ³Ό μ μλ‹¤.

---

### 4. μ ‘μ† ν™•μΈ λ° λ΅λ“ λ°Έλ°μ‹± ν…μ¤νΈ

μ΄μ  λΈλΌμ°μ €λ‚ ν„°λ―Έλ„μ—μ„ `localhost:30000`μΌλ΅ μ ‘μ†ν•μ—¬ ν†µμ‹ μ΄ λλ”μ§€ ν™•μΈν•λ‹¤.

```bash
$ curl localhost:30000
```

#### π–ΌοΈ μ „μ²΄ κµ¬μ΅°λ„

```mermaid
graph LR
    User((μ‚¬μ©μ)) -- "μ ‘μ† (localhost:30000)" --> Service[Service: spring-service]
    
    subgraph "Kubernetes Cluster"
        Service -- "νΈλν”½ λ¶„μ‚° (TargetPort: 8080)" --> Pod1
        Service -- "νΈλν”½ λ¶„μ‚°" --> Pod2
        Service -- "νΈλν”½ λ¶„μ‚°" --> Pod3
        
        subgraph "Pods (Deployment)"
            Pod1["Pod: backend-1<br/>(label: app=backend-app)"]
            Pod2["Pod: backend-2<br/>(label: app=backend-app)"]
            Pod3["Pod: backend-3<br/>(label: app=backend-app)"]
        end
    end
```

μ„λΉ„μ¤λ” `selector`μ— λ…μ‹λ `app: backend-app` λΌλ²¨μ„ κ°€μ§„ λ¨λ“  νλ“λ“¤μ„ μλ™μΌλ΅ μ°Ύμ•„ νΈλν”½μ„ κ³ λ¥΄κ² λ¶„μ‚°ν•΄ μ¤€λ‹¤. νλ“ ν•λ‚μ— μ¥μ• κ°€ μƒκ²¨ κµμ²΄λλ”λΌλ„ μ„λΉ„μ¤μ μ ‘μ† μ£Όμ†λ” λ³€ν•μ§€ μ•μΌλ―€λ΅ μ•μ •μ μΈ ν†µμ‹ μ΄ κ°€λ¥ν•λ‹¤.
